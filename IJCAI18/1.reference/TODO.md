# TODO

## 1.尝试模型

## 1.1尝试FM/FFM模型

- FFM、 LR等模型使用连续型特征前需要对特征进行分箱 



## 2.特征工程

- 每次测试特征前都会对当前特征做分析，当特征在不同取值下转化率有较大差别的情况下才会用模型测试。 

### 2.1滑动窗口特征

### 2.2高维特征的处理

- f0、f1、f3、f4、f5、f10、f15、f18、f19

- 稀疏矩阵

- hash

- embedding：

  - 假设：一起浏览的商品具有相似性
  - 生成词向量（10维）：

  ![52204993017](C:\Users\LUCKYG~1\AppData\Local\Temp\1522049930170.png)

- 基于经验贝叶斯的概率估计：A Preprocessing Scheme for High-Cardinality Categorical Attributes in Classification and Prediction Problems. SIGKDD ，转化为连续值

### 2.3特征组合

- [OK]加浏览计数统计数据：线下有提升，线上没有提升，保留。
- [OK]购买率特征、购买量特征、浏览量特征改为多粒度划窗：

  - 当前时间前所有的日期
  - 当前时间前一天
  - 当前时间前两天
  - 当前时间前三天
  - 当前时间前一个小时
  - 当前时间前一分钟
  - 当前时间前五分钟
- [OK]当日统计、转化特征：
- [OK]冷启动特征：
  - [OK]用户是否第一次浏览
  - [OK]店铺是否第一次被浏览
  - ……
- [OK]展示、收藏比例
- 近时间特征：
  - [OK]上次浏览时间？
  - [OK]上次购买时间？
  - [OK]距离用户上次浏览时间
  - [OK]距离用户上次购买时间
  - **上次购买的商品名**
  - **上次浏览的商品名**
- [OK]leak特征：
  - [OK]当前是否是用户今天最后一次浏览
  - [OK]今天内各个用户的浏览量
  - [OK]距离下一次浏览的时间间隔



- **刻画关注的持续程度：**

  - **数值变化率特征：最近4天的浏览数变化率（最近4天的浏览数/最近5-8天的浏览数）、最近购买数变化率+多粒度滑窗**
  - **十分钟内是否连续点击**
- **时间特征：**

  - **最早最晚时间：最早购买时间、最晚购买时间、最早浏览时间、最晚浏览时间**
  - **用户当天第几次点击当前APP**
  - **时间再细化？24->48？**
- **用户对商品价格、品牌的不购买率**
- **其他交叉特征：**

  - **商品-年龄**
  - **商品-地点**
  - **……**
- **再尝试不同粒度：分钟？**
- **FFM、 LR等模型使用连续型特征前需要对特征进行分箱** 
- **用户感兴趣的商品？**
- [OK]（分层）贝叶斯平滑：r=(C+α)/(I+α+β)，C表示购买次数、I表示浏览次数，参考文献：Click-Through Rate Estimation for Rare Events In Online Adversting 
- **通过划窗来增加样本势必会带来时间跨度不统一而带来的特征量级不同的问题，我们用日均点击量代替历史点击量，日均转化量代替历史转化量，使得特征量级归一化。**
- **将出现次数较少的ID直接归为一类**  



## 3.训练集和验证集划分

### 3.1滑动窗口五折交叉验证？

- 训练数据的末尾几天由于转化时间的滞后性，存在错误标签的样本，越靠近第30天，错误样本的比例越大，线上成绩反馈表明，直接将第30天放入训练样本中训练，成绩将会大幅下降。为此我们定义了app非当天转化率来对数据做清洗 


![52204740791](C:\Users\LUCKYG~1\AppData\Local\Temp\1522047407916.png)

## 3.2训练集中去掉前面几天的数据（17号？）

- 暂时没有效果，待后期观察






## 4.模型融合

### 4.0基本模型

- gbdt
- wide&deep
- Product-Base Neural	Networks(PNN网络) 
- Networks on Field-aware Factorization Machine(NFFM网络)
-  XGBOOST训练出来的决策树在每个树节点分裂时选择的是最优的分裂点，这些分裂点是经过树模型
  选择出来的最优结果，我们可以直接借助这些分裂点对连续特征分箱。 

### 4.1statcking

- 多层融合
- logit逆变化后融合 
- 8模型：1 * GBDT+1 * wide&deep+2 * PNN+4 * NFFM 
- 3 * lgb + 1*xgb + 2*ffm
- 类别特征+（排序特征 +连续特征->xgb+lgb+xgb/ffm）->FFM
- lr+fm+ffm-5+deepfm+xgb+lgb-3->逆变换->LR\LGB
- ffm+lr+lbg+gbdt+et->lgb
- ffm/fm + Tree + lr
- FFM+XGB叶子节点特征 



# 5.数据清洗

## 5.1数据去噪（离群点）

- 报送延迟（回流时间过长）
  - 删除最后一天数据：效果变差。
  - 定义了app非当天转化率来对数据做清洗：app非当天转化率 = app非当天转化总数 / app转化总数 
  - 删除30号中平均转化回流时间较长的数据：
  - 删除30号转化回流时间较长的app：
  - 删除每个最后一次转化之后的样本 
- ​